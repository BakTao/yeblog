<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tao.yeblog.dao.BlogMapper">

    <select id="pageBlogInfo" parameterType="com.tao.yeblog.model.qo.BlogQO"
            resultType="com.tao.yeblog.model.dto.BlogDTO">
      select t1.blogid blogId,
      t2.loginid userId,
      t1.columnid columnId,
      t3.name columnName,
      t1.title title,
      t1.type type,
      t1.enable enable,
      t1.content content,
      t1.cover cover,
      t1.createtime createTime
      from blog t1
      left join blog_user t2 on t1.userid = t2.id
      left join yeblog_db.column  t3 on t1.columnid = t3.id
      where 1=1
      <if test="title !=null and title != ''">
        and t1.title like (concat('%',#{title},'%'))
      </if>
      <if test="blogId !=null and blogId != ''">
        and t1.blogId like (concat('%',#{blogId},'%'))
      </if>
      <if test="userId !=null and userId != ''">
        and t2.loginid like (concat('%',#{userId},'%'))
      </if>
      <if test="enable !=null and enable != ''">
        and t1.enable = #{enable}
      </if>
      <if test="columnId !=null and columnId != ''">
        and t1.columnid like (concat('%',#{columnId},'%'))
      </if>
      <if test="createTimeQ !=null and createTimeQ != ''">
        and t1.createtime >= date_format(#{createTimeQ},'%Y-%m-%d')
      </if>
      <if test="createTimeZ !=null and createTimeZ != ''">
        and t1.createtime &lt;= date_format(#{createTimeZ},'%Y-%m-%d')
      </if>
      <if test="type !=null and type != ''">
        and t1.type in
        <foreach collection="types" item="type" open="(" close=")" separator=",">
          #{type}
        </foreach>
      </if>
      <if test="columnId !=null and columnId != ''">
        and t3.columnid in
        <foreach collection="columnIds" item="columnId" open="(" close=")" separator=",">
          #{columnId}
        </foreach>
      </if>
    </select>

    <update id="updateBlogInfo" parameterType="com.tao.yeblog.model.dto.BlogDTO">
      update blog t
      <set>
        <if test="enable != null and enable != ''">
          t.enable = #{enable},
        </if>
        <if test="reason != null">
          t.reason = #{reason},
        </if>
      </set>
      where 1=1
      <if test="blogId !=null and blogId != ''">
        and t.blogid in
        <foreach collection="blogIds" item="blogId" open="(" close=")" separator=",">
          #{blogId}
        </foreach>
      </if>
    </update>

</mapper>
