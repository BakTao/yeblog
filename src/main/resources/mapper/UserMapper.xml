<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tao.yeblog.dao.UserMapper">

    <select id="pageUserInfo" parameterType="com.tao.yeblog.model.qo.UserQO"
            resultType="com.tao.yeblog.model.dto.UserDTO">
      select t1.name name,
      t1.sex sex,
      t1.loginid loginId,
      t1.password password,
      t1.lastlogip lastLogIp,
      t1.lastlogtime lastLogTime,
      t1.userphoto userPhoto,
      t1.regtime regTime,
      t1.phone phone,
      t1.email email,
      t1.enable enable,
      t1.reason reason,
      count(t2.id) blogCount,
      count(t3.id) ownBlogCount,
      count(t4.id) noOwnBlogCount,
      count(t5.id) testBlogCount
      from blog_user t1
      left join blog t2 on t1.id = t2.userid
      left join (select * from blog where `type` = '0') t3 on t2.id = t3.id
      left join (select * from blog where `type` = '1') t4 on t2.id = t4.id
      left join (select * from blog where `type` = '2') t5 on t2.id = t5.id
      group by t1.id
    </select>

    <update id="updateUserInfo" parameterType="com.tao.yeblog.model.dto.UserDTO">
      update blog_user t
      <set>
        <if test="enable != null and enable != ''">
          t.enable = #{enable}
        </if>
      </set>
      where 1=1
      <if test="loginId != null and loginId != ''">
        t.loginid = #{loginId}
      </if>
    </update>

</mapper>
